---
import Layout from "../layouts/Layout.astro";
import PostCardList from "../components/PostCardList.astro";
import Pagination from "../components/Pagination.astro";
import { getCollection } from "astro:content";
import { getPostHref } from "../utils/posts";
import { PAGE_SIZE } from "../config";

const posts = (await getCollection("blog"))
	.filter((post) => !post.data.draft)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const totalPages = Math.max(1, Math.ceil(posts.length / PAGE_SIZE));
const pagePosts = posts.slice(0, PAGE_SIZE);

const items = pagePosts.map((post) => ({
	title: post.data.title,
	href: getPostHref(post),
	date: post.data.pubDate,
	description: post.data.description,
	image: post.data.image,
	imageAlt: post.data.imageAlt,
}));
---

<Layout
	title="遊戲與AI探索"
	description="一個創作者的漂流地圖：遊戲開發、AI 工具與數位創作"
>
	<section class="p-6">
		<div class="space-y-20">
			<PostCardList items={items} />
			<Pagination
				currentPage={1}
				totalPages={totalPages}
				basePath="/"
				pagePath="/page"
			/>
		</div>
	</section>
</Layout>
